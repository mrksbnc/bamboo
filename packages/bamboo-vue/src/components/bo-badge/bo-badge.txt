<template>
	<span
		:id="id"
		:data-testid="dataTestId"
		:class="classValues"
		:role="role"
		:aria-label="ariaLabel"
	>
		<!-- Prefix icon or icon-only icon -->
		<span v-if="showPrefixIcon" :class="prefixIconContainerClassValues">
			<bo-icon :size="iconSize" :icon="prefixOrIconOnlySrc" class="bo-badge__prefix-icon" />
		</span>

		<!-- Label -->
		<slot name="default">
			<bo-text
				v-if="renderLabel && label"
				:value="label"
				:font-size="badgeFontSize"
				font-weight="semibold"
				class="bo-badge__label"
			/>
		</slot>

		<!-- Suffix icon -->
		<span v-if="showSuffixIcon" :class="suffixIconContainerClassValues">
			<bo-icon :icon="icon!.suffix!" :size="iconSize" class="bo-badge__suffix-icon" />
		</span>
	</span>
</template>

<script lang="ts" setup>
	import { IdentityService, useBoBadge, type BoBadgeProps } from '@workspace/bamboo-core';
	import { computed } from 'vue';
	import { BoIcon } from '../bo-icon';
	import { BoText } from '../bo-text';

	const props = withDefaults(defineProps<BoBadgeProps>(), {
		id: () => IdentityService.instance.getComponentId('bo-badge'),
		dataTestId: () => IdentityService.instance.getDataTestId('bo-badge'),
		type: 'default',
		size: 'default',
		shape: 'default',
		variant: 'primary',
		icon: () => ({
			prefix: 'none',
			suffix: 'none',
		}),
	});

	const {
		badgeFontSize,
		iconSize,
		isIconOnly,
		isCircle,
		renderLabel,
		prefixOrIconOnlySrc,
		prefixIconContainerClassValues,
		suffixIconContainerClassValues,
		classValues,
	} = useBoBadge(props);

	const showPrefixIcon = computed<boolean>(() => {
		return (
			(props.icon?.prefix !== undefined && props.icon.prefix !== 'none') ||
			isIconOnly.value ||
			isCircle.value
		);
	});

	const showSuffixIcon = computed<boolean>(() => {
		return (
			props.icon?.suffix !== undefined &&
			props.icon.suffix !== 'none' &&
			!isIconOnly.value &&
			!isCircle.value
		);
	});
</script>
